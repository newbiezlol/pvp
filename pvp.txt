-- üß± Load Service
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local MAX_TRACK_DISTANCE = 80
local UPDATE_INTERVAL = 0.5

LocalPlayer.CharacterAdded:Connect(function(char)
	Character = char
	HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

-- üé® UI Setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "RezUI"
local frame = Instance.new("Frame", gui)
frame.Position = UDim2.new(0.7, 0, 0.35, 0)
frame.Size = UDim2.new(0, 280, 0, 320)
frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
local uiStroke = Instance.new("UIStroke", frame)
uiStroke.Thickness = 2
uiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
task.spawn(function()
	while true do
		for h = 0, 1, 0.01 do
			uiStroke.Color = Color3.fromHSV(h, 1, 1)
			task.wait()
		end
	end
end)
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

-- üìå Titles
local title = Instance.new("TextLabel", frame)
title.Text = "üíÄ Rez üíÄ"
title.Position = UDim2.new(0, 0, 0, 5)
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(0, 0, 0)
title.Font = Enum.Font.FredokaOne
title.TextSize = 22
local subtitle = Instance.new("TextLabel", frame)
subtitle.Text = "B√° S√†n CDVN"
subtitle.Position = UDim2.new(0, 0, 0, 35)
subtitle.Size = UDim2.new(1, 0, 0, 20)
subtitle.BackgroundTransparency = 1
subtitle.TextColor3 = Color3.fromRGB(255, 0, 0)
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 14

-- üìÜ Button container
local buttonContainer = Instance.new("Frame", frame)
buttonContainer.Position = UDim2.new(0, 15, 0, 45)
buttonContainer.Size = UDim2.new(1, -30, 1, -60)
buttonContainer.BackgroundTransparency = 1
local layout = Instance.new("UIListLayout", buttonContainer)
layout.FillDirection = Enum.FillDirection.Vertical
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center
layout.Padding = UDim.new(0, 10)

local function createButton(name)
	local btn = Instance.new("TextButton")
	btn.Text = name
	btn.Size = UDim2.new(1, 0, 0, 40)
	btn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	btn.BackgroundTransparency = 0.2
	btn.TextColor3 = Color3.fromRGB(0, 0, 0)
	btn.Font = Enum.Font.GothamMedium
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	local stroke = Instance.new("UIStroke", btn)
	stroke.Thickness = 1.2
	stroke.Color = Color3.fromRGB(200, 200, 200)
	return btn
end

-- üîä Auto Attack
local attacking = false
task.spawn(function()
	while true do
		task.wait(0.1)
		if attacking then
			local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
			if tool then pcall(function() tool:Activate() end) end
		end
	end
end)

-- ‚û°Ô∏è Orbit 360
local orbit360 = false
local orbitBtn = createButton("üîÑ Xoay quanh Player")
orbitBtn.Parent = buttonContainer
orbitBtn.MouseButton1Click:Connect(function()
	orbit360 = not orbit360
	orbitBtn.Text = orbit360 and "‚úÖ Xoay : B·∫≠t" or "üîÑ Xoay quanh Player"
end)
RunService.Heartbeat:Connect(function()
	if orbit360 and Character and HumanoidRootPart then
		local nearest = nil
		local shortest = math.huge
		for _, p in ipairs(Players:GetPlayers()) do
			if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
				local dist = (HumanoidRootPart.Position - p.Character.HumanoidRootPart.Position).Magnitude
				if dist < shortest then
					shortest = dist
					nearest = p
				end
			end
		end
		if nearest and nearest.Character then
			local center = nearest.Character.HumanoidRootPart.Position
			local radius = 15
			local speed = 5
			local t = tick() * speed
			local offset = Vector3.new(math.cos(t) * radius, 0, math.sin(t) * radius)
			HumanoidRootPart.CFrame = CFrame.new(center + offset, center)
		end
	end
end)

-- ‚ö†Ô∏è G·ªôp ESP + Hitbox
local comboESP = false
local comboBtn = createButton("Hitbox Player")
comboBtn.Parent = buttonContainer
comboBtn.MouseButton1Click:Connect(function()
	comboESP = not comboESP
	comboBtn.Text = comboESP and "‚ùå Hitbox" or "‚úÖ Hitbox Player"
	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
			local root = p.Character.HumanoidRootPart
			if comboESP then
				local hl = Instance.new("Highlight")
				hl.Name = "ESP"
				hl.Adornee = p.Character
				hl.FillColor = Color3.fromRGB(255,0,0)
				hl.FillTransparency = 0.5
				hl.OutlineTransparency = 0
				hl.Parent = game.CoreGui
				root.Size = Vector3.new(10,10,10)
				root.Material = Enum.Material.ForceField
				root.Transparency = 0.5
			else
				if game.CoreGui:FindFirstChild("ESP") then
					game.CoreGui.ESP:Destroy()
				end
				root.Size = Vector3.new(2,2,1)
				root.Material = Enum.Material.Plastic
				root.Transparency = 1
			end
		end
	end
end)

-- ‚öîÔ∏è Auto Attack Button
local autoAttackBtn = createButton("üî™ T·ª± ƒë√°nh khi c·∫ßm v≈© kh√≠")
autoAttackBtn.Parent = buttonContainer
autoAttackBtn.MouseButton1Click:Connect(function()
	attacking = not attacking
	autoAttackBtn.Text = attacking and "Andrenalin üíÄ" or "üî™ T·ª± ƒë√°nh khi c·∫ßm v≈© kh√≠"
end)

local spinEnabled = false
local spinAngle = 0

-- üîò N√∫t xoay t·∫°i ch·ªó
local spinButton = createButton("üîÅ Xoay T·∫°i Ch·ªó")
spinButton.Parent = buttonContainer

spinButton.MouseButton1Click:Connect(function()
	spinEnabled = not spinEnabled
	spinButton.Text = spinEnabled and "‚úÖ ƒêang xoay t·∫°i ch·ªó" or "üîÅ Xoay T·∫°i Ch·ªó "
end)

-- üîÅ V√≤ng l·∫∑p quay nh√¢n v·∫≠t
RunService.Heartbeat:Connect(function(dt)
	if spinEnabled and Character and Character:FindFirstChild("HumanoidRootPart") then
		spinAngle += dt * 30  -- ch·ªânh 3 th√†nh cao h∆°n n·∫øu mu·ªën quay nhanh h∆°n
		local root = Character.HumanoidRootPart
		local pos = root.Position
		root.CFrame = CFrame.new(pos) * CFrame.Angles(0, spinAngle, 0)
	end
end)

-- ‚öôÔ∏è Bi·∫øn ƒëi·ªÅu khi·ªÉn
local showHealth = false
local healthUI = {}

-- üì¶ T·∫°o n√∫t hi·ªÉn th·ªã m√°u
local HealthToggleBtn = createButton("üìä Hi·ªÉn th·ªã m√°u NPC/Ng∆∞·ªùi ch∆°i")
HealthToggleBtn.Parent = buttonContainer
HealthToggleBtn.MouseButton1Click:Connect(function()
	showHealth = not showHealth
	HealthToggleBtn.Text = showHealth and "‚úÖ ƒêang hi·ªÉn th·ªã m√°u..." or "üìä Hi·ªÉn th·ªã m√°u NPC/Ng∆∞·ªùi ch∆°i"

	if not showHealth then
		-- X√≥a thanh m√°u khi t·∫Øt
		for _, gui in pairs(healthUI) do
			if gui and gui.Parent then
				gui:Destroy()
			end
		end
		healthUI = {}
	end
end)

-- üîÅ V√≤ng l·∫∑p c·∫≠p nh·∫≠t m√°u
task.spawn(function()
	while task.wait(UPDATE_INTERVAL) do
		if showHealth then
			local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
			if not myRoot then continue end

			for _, model in pairs(workspace:GetDescendants()) do
				if model:IsA("Model") and model:FindFirstChild("Humanoid") and model:FindFirstChild("Head") and model ~= LocalPlayer.Character then
					local humanoid, head = model.Humanoid, model.Head
					local dist = (myRoot.Position - head.Position).Magnitude

					if dist <= MAX_TRACK_DISTANCE then
						if not healthUI[model] or not healthUI[model].Parent then
							local bill = Instance.new("BillboardGui", head)
							bill.Name = "HealthBar"
							bill.Size = UDim2.new(4, 0, 0.5, 0)
							bill.StudsOffset = Vector3.new(0, 2.5, 0)
							bill.Adornee = head
							bill.AlwaysOnTop = true

							local bg = Instance.new("Frame", bill)
							bg.Name = "BG"
							bg.Size = UDim2.new(1, 0, 1, 0)
							bg.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
							bg.BorderSizePixel = 0

							local hpBar = Instance.new("Frame", bg)
							hpBar.Name = "HP"
							hpBar.Size = UDim2.new(1, 0, 1, 0)
							hpBar.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
							hpBar.BorderSizePixel = 0

							local hpText = Instance.new("TextLabel", bg)
							hpText.Name = "HPText"
							hpText.Size = UDim2.new(1, 0, 1, 0)
							hpText.BackgroundTransparency = 1
							hpText.TextColor3 = Color3.new(1, 1, 1)
							hpText.TextStrokeTransparency = 0.5
							hpText.TextScaled = true
							hpText.Font = Enum.Font.GothamBold
							hpText.Text = ""

							healthUI[model] = bill
						end

						local barBG = healthUI[model]:FindFirstChild("BG")
						if barBG and barBG:FindFirstChild("HP") and barBG:FindFirstChild("HPText") then
							local currentHP = humanoid.Health
							local maxHP = humanoid.MaxHealth
							local ratio = math.clamp(currentHP / maxHP, 0, 1)

							barBG.HP.Size = UDim2.new(ratio, 0, 1, 0)
							barBG.HPText.Text = string.format("%d / %d", math.floor(currentHP), math.floor(maxHP))
						end
					else
						-- Qu√° xa ‚Üí x√≥a thanh m√°u
						if healthUI[model] then
							healthUI[model]:Destroy()
							healthUI[model] = nil
						end
					end
				end
			end
		end
	end
end)

if not showHealth then
	for _, gui in pairs(healthUI) do
		if gui and gui.Parent then gui:Destroy() end
	end
	healthUI = {}
end


-- ‚ùå Close GUI
local closeBtn = Instance.new("TextButton", frame)
closeBtn.Text = "‚úñ"
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.Size = UDim2.new(0, 30, 0, 25)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)
closeBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)
